version: '3.8'

services:
  leader:
    build:
      context: ../..           # Project root
      dockerfile: Dockerfile   # ← Uses existing Dockerfile
    container_name: logstream-pc-leader
    environment:
      - IS_LEADER=true
      - NODE_ADDRESS=172.27.0.10:8001
    networks:
      logstream-pc-net:
        ipv4_address: 172.27.0.10

  producer:
    build:
      context: ../..                    # Project root
      dockerfile: Dockerfile.producer   # ← Uses Dockerfile.producer
    container_name: logstream-pc-producer
    environment:
      - LEADER_ADDRESS=172.27.0.10:8001
      - TOPIC=test-logs
    networks:
      - logstream-pc-net

  consumer:
    build:
      context: ../..                    # Project root
      dockerfile: Dockerfile.consumer   # ← Uses Dockerfile.consumer
    container_name: logstream-pc-consumer
    environment:
      - LEADER_ADDRESS=172.27.0.10:8001
      - TOPIC=test-logs
    networks:
      - logstream-pc-net

networks:
  logstream-pc-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.27.0.0/24